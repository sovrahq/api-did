{"version":3,"file":"sovra.cjs.development.js","sources":["../src/SovraLedger.ts"],"sourcesContent":["/*\n * Sovra Ledger - DID anchoring for ethrex network by LambdaClass\n *\n * This ledger extends EthereumLedger with:\n * - Sovra-specific branding and logging\n * - Chunked event fetching for scalability\n * - Explorer URL integration for transaction tracking\n *\n * Network: ethrex (https://github.com/lambdaclass/ethrex)\n * DID Method: did:quarkid:sovra\n */\n\nimport {\n  EthereumLedgerUtils as ethereumLedgerUtils,\n  EthereumLedger,\n  ElementEventData,\n  EthereumFilter\n} from '@quarkid-sidetree/ethereum';\n\nimport {\n  BlockchainTimeModel,\n  TransactionModel,\n  ServiceVersionModel\n} from '@quarkid-sidetree/common';\n\nimport Web3 from 'web3';\n\nconst { version } = require('../package.json');\n\n// Sovra network configuration\nconst SOVRA_CONFIG = {\n  testnet: {\n    explorer: 'https://explorer.testnet.sovra.io',\n    rpc: 'https://rpc.testnet.sovra.io'\n  },\n  mainnet: {\n    explorer: 'https://explorer.sovra.io', // TBD\n    rpc: 'https://rpc.sovra.io' // TBD\n  }\n};\n\nexport default class SovraLedger extends EthereumLedger {\n  // Branding prefix for all Sovra logs\n  private readonly SOVRA_PREFIX = '[Sovra]';\n\n  // Chunked fetching state (following RSKLedger pattern)\n  protected lastSyncedBlockchainTime: number = 0;\n  protected startingTime: number = 0;\n\n  // Default to testnet explorer\n  private explorerBaseUrl: string = SOVRA_CONFIG.testnet.explorer;\n\n  constructor(\n    web3: Web3,\n    protected eventPullChunkSize: number,\n    public contractAddress?: string,\n    startingBlockchainTime?: number,\n    logger?: Console\n  ) {\n    super(web3, contractAddress, logger);\n\n    if (startingBlockchainTime) {\n      this.startingTime = startingBlockchainTime;\n    }\n  }\n\n  /**\n   * Returns service version identifying this as 'sovra' ledger\n   */\n  getServiceVersion(): Promise<ServiceVersionModel> {\n    return Promise.resolve({\n      name: 'sovra',\n      version,\n    });\n  }\n\n  /**\n   * Initialize the ledger with Sovra-specific logging\n   */\n  public async initialize(): Promise<void> {\n    this.logger.log(`${this.SOVRA_PREFIX} Initializing Sovra Ledger (ethrex by LambdaClass)...`);\n\n    if (this.contractAddress) {\n      this.logger.log(`${this.SOVRA_PREFIX} Anchor contract: ${this.contractAddress}`);\n    }\n\n    // Call parent initialization (sets up account, networkId, contract)\n    await super.initialize();\n\n    // If no starting time was provided and contract was just deployed, use current block\n    if (!this.contractAddress) {\n      this.startingTime = (await this.getLatestTime()).time;\n    }\n\n    // Log connection details\n    this.logger.log(`${this.SOVRA_PREFIX} Connected to Sovra network`);\n    this.logger.log(`${this.SOVRA_PREFIX}   Network ID: ${this.networkId}`);\n    this.logger.log(`${this.SOVRA_PREFIX}   Account: ${this.from}`);\n    this.logger.log(`${this.SOVRA_PREFIX}   Explorer: ${this.explorerBaseUrl}`);\n    this.logger.log(`${this.SOVRA_PREFIX} Ledger ready for DID operations`);\n  }\n\n  /**\n   * Helper to check if a value is a number\n   */\n  private isNumber(n: any): boolean {\n    return !isNaN(parseFloat(n)) && !isNaN(n - 0);\n  }\n\n  /**\n   * Fetch transactions with chunked event fetching for better performance\n   * Following RSKLedger pattern for scalability\n   */\n  public _getTransactions = async (\n    fromBlock: number | string,\n    toBlock: number | string,\n    options?: { filter?: EthereumFilter; omitTimestamp?: boolean }\n  ): Promise<TransactionModel[]> => {\n    const contract = await this.getAnchorContract();\n\n    // Resolve block numbers if strings like 'latest' are provided\n    let from: number;\n    if (this.isNumber(fromBlock)) {\n      from = fromBlock as number;\n    } else {\n      from = (await ethereumLedgerUtils.getBlock(this.web3, fromBlock)).number;\n    }\n\n    let to: number;\n    if (this.isNumber(toBlock)) {\n      to = toBlock as number;\n    } else {\n      to = (await ethereumLedgerUtils.getBlock(this.web3, toBlock)).number;\n    }\n\n    // Use the most recent synced position to avoid re-fetching\n    const effectiveFrom = Math.max(from, this.lastSyncedBlockchainTime);\n\n    this.logger.log(`${this.SOVRA_PREFIX} Fetching events from block ${effectiveFrom} to ${to}...`);\n\n    // Chunked fetching prevents memory issues with large block ranges\n    const { events, lastSynced } = await ethereumLedgerUtils.getPastEventsChunked(\n      contract,\n      'Anchor',\n      effectiveFrom,\n      to,\n      this.eventPullChunkSize,\n      options?.filter\n    );\n\n    this.logger.log(`${this.SOVRA_PREFIX} Fetched ${events.length} anchor event(s)`);\n\n    // Update last synced position\n    if (lastSynced > this.lastSyncedBlockchainTime) {\n      this.lastSyncedBlockchainTime = lastSynced;\n    }\n\n    // Convert events to Sidetree transaction format\n    const txns = events.map((log) =>\n      ethereumLedgerUtils.eventLogToSidetreeTransaction(log as ElementEventData)\n    );\n\n    if (options?.omitTimestamp) {\n      return txns;\n    }\n\n    return ethereumLedgerUtils.extendSidetreeTransactionWithTimestamp(this.web3, txns);\n  };\n\n  /**\n   * Helper to get transactions since a specific transaction number\n   */\n  private async _getTransactionsSince(\n    fromBlock: number | string,\n    toBlock: number | string,\n    since: number,\n    options?: { filter?: EthereumFilter; omitTimestamp?: boolean }\n  ): Promise<TransactionModel[]> {\n    const transactions = await this._getTransactions(fromBlock, toBlock, options);\n    return transactions.filter(x => x.transactionNumber > since);\n  }\n\n  /**\n   * Read transactions with optimized chunked fetching\n   */\n  public async read(\n    sinceTransactionNumber?: number,\n    transactionTimeHash?: string\n  ): Promise<{ moreTransactions: boolean; transactions: TransactionModel[] }> {\n    const options = { omitTimestamp: true };\n    let transactions: TransactionModel[];\n\n    if (sinceTransactionNumber !== undefined) {\n      // Path 1: Get transactions since a specific transaction number\n      transactions = await this._getTransactionsSince(\n        this.startingTime,\n        'latest',\n        sinceTransactionNumber,\n        options\n      );\n    } else if (transactionTimeHash) {\n      // Path 2: Get transactions from a specific block\n      const block = await ethereumLedgerUtils.getBlock(this.web3, transactionTimeHash);\n      if (block?.number) {\n        transactions = await this._getTransactions(block.number, block.number, options);\n      } else {\n        transactions = [];\n      }\n    } else {\n      // Path 3: Get all transactions from starting block\n      transactions = await this._getTransactions(this.startingTime, 'latest', options);\n    }\n\n    return {\n      moreTransactions: false,\n      transactions,\n    };\n  }\n\n  /**\n   * Write anchor to Sovra blockchain with branded logging\n   */\n  public write = async (anchorString: string, _fee = 0): Promise<void> => {\n    this.logger.log(`${this.SOVRA_PREFIX} Preparing to anchor batch to Sovra blockchain...`);\n\n    const contract = await this.getAnchorContract();\n    const { numberOfOperations, buffer } = this.getWriteData(anchorString);\n\n    this.logger.log(`${this.SOVRA_PREFIX} Batch contains ${numberOfOperations} DID operation(s)`);\n\n    try {\n      const methodCall = contract.methods.anchorHash(\n        '0x' + buffer.toString('hex').substring(4),\n        numberOfOperations\n      );\n\n      // Estimate gas and get current gas price\n      const currentGasPrice = await this.web3.eth.getGasPrice();\n      const gas = await methodCall.estimateGas();\n      const gasPrice = Math.round(parseInt(currentGasPrice) * 1).toString();\n\n      this.logger.log(`${this.SOVRA_PREFIX} Sending transaction (gas: ${gas}, gasPrice: ${gasPrice})...`);\n\n      const txn = await methodCall.send({\n        from: this.from,\n        gas,\n        gasPrice\n      });\n\n      // Log success with explorer link\n      const txUrl = `${this.explorerBaseUrl}/tx/${txn.transactionHash}`;\n      this.logger.info(`${this.SOVRA_PREFIX} Batch anchored successfully!`);\n      this.logger.info(`${this.SOVRA_PREFIX}   Transaction: ${txn.transactionHash}`);\n      this.logger.info(`${this.SOVRA_PREFIX}   Explorer: ${txUrl}`);\n      this.logger.info(`${this.SOVRA_PREFIX}   Operations: ${numberOfOperations}`);\n\n    } catch (err) {\n      const error = err as Error;\n      this.logger.error(`${this.SOVRA_PREFIX} Transaction failed: ${error.message}`);\n      throw err;\n    }\n  };\n\n  /**\n   * Get approximate blockchain time from cache\n   */\n  public get approximateTime(): BlockchainTimeModel {\n    return this.cachedBlockchainTime;\n  }\n\n  /**\n   * Set explorer URL (useful for switching between testnet/mainnet)\n   */\n  public setExplorerUrl(url: string): void {\n    this.explorerBaseUrl = url;\n    this.logger.log(`${this.SOVRA_PREFIX} Explorer URL updated to: ${url}`);\n  }\n}\n"],"names":["_require","require","version","SOVRA_CONFIG","testnet","explorer","rpc","mainnet","SovraLedger","_EthereumLedger","_inheritsLoose","web3","eventPullChunkSize","contractAddress","startingBlockchainTime","logger","_this","call","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","fromBlock","toBlock","options","contract","from","to","effectiveFrom","_yield$ethereumLedger","events","lastSynced","txns","wrap","_callee$","_context","prev","next","getAnchorContract","sent","isNumber","ethereumLedgerUtils","getBlock","number","Math","max","lastSyncedBlockchainTime","log","SOVRA_PREFIX","getPastEventsChunked","filter","length","map","eventLogToSidetreeTransaction","omitTimestamp","abrupt","extendSidetreeTransactionWithTimestamp","stop","_x","_x2","_x3","apply","arguments","_ref2","_callee2","anchorString","_fee","_this$getWriteData","numberOfOperations","buffer","methodCall","currentGasPrice","gas","gasPrice","txn","txUrl","error","_callee2$","_context2","getWriteData","methods","anchorHash","toString","substring","eth","getGasPrice","estimateGas","round","parseInt","send","explorerBaseUrl","transactionHash","info","t0","message","_x4","_x5","startingTime","_proto","prototype","getServiceVersion","Promise","resolve","name","initialize","_initialize","_callee3","_callee3$","_context3","getLatestTime","time","networkId","n","isNaN","parseFloat","_getTransactionsSince","_getTransactionsSince2","_callee4","since","transactions","_callee4$","_context4","_getTransactions","x","transactionNumber","_x6","_x7","_x8","_x9","read","_read","_callee5","sinceTransactionNumber","transactionTimeHash","block","_callee5$","_context5","undefined","moreTransactions","_x10","_x11","setExplorerUrl","url","_createClass","key","get","cachedBlockchainTime","EthereumLedger"],"mappings":"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"}